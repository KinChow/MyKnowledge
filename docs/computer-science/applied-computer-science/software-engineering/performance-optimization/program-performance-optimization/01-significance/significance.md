# 软件性能优化的意义

## 背景

### 处理器架构发展

#### 单核结构

单核指CPU集成了一个运算核心。单核处理器的性能与主频和每个时钟周期内执行的指令数相关。一般有两种提升单核处理器性能的方法，第一种是提高主频，第二种是提高每个时钟周期内的执行效率。



##### 提高主频

超大规模集成电路工艺的发展，使得单颗芯片上可集成更多的资源，为处理器体系结构的发展提供了源源动力，通过改进处理器体系结构获得更高的时钟频率是单核处理器设计的重要方向之一。



##### 提高每个时钟周期的执行效率

提高每个时钟周期内的执行效率的方式之一就是采用并行计算，分为指令级并行和数据级并行：

* 指令级并行是指处理器同时执行多条指令
* 数据级并行是指对程序中的多个数据进行相同操作



#### 多核结构

多核处理器即在一个单芯片上集成多个处理器内核，其中每个核都是一个独立的物理处理器，多核处理器支持多个线程在多个处理器核上同时执行，使得整个处理器可同时执行的线程数目是单处理器的数倍，极大地提升了处理器的性能。



#### 众核结构

众核处理器由几十到几千个功能较小的内核组成，使用针对更大并行性和吞吐量进行优化的嵌入式处理器，产生大规模的并行数据流，降低完成任务的功耗。众核还能够通过增强的线程同步来解决数据瓶颈的问题。众核与多核之间的关键区别包括处理器核心的数量以及实际的处理器结构。多核处理器一般核心数量较少，同时他们的总线结构也不一样，一个是片上的总线矩阵，一个是片上网络。



#### 异构结构

异构多核是指将功能或性能相异的处理器通过一定的互连结构连接起来，一般由通用处理器和专用加速处理器构成，在芯片内面向不同的指令集成了不同类型的计算部件。典型代表为索尼、IBM和东芝联合研发的Cell处理器。



#### 专用结构

专用处理器是通过将硬件架构进行定制并使其具备特定领域应用特征，使得该领域的一系列应用任务都能高效执行，例如在机器学习领域，比较有代表性的专用架构为Google的张量处理器TPU，专用于神经网络运算、神经机器翻译等诸多任务。



### 存储结构的发展

在过去的几十年中，处理器性能以每年50%至100%的速度平稳增长，而存储器的性能却只以每年7%左右的速度增长，可以断言的是未来处理器与存储器之间的速度差异将会越来越大。一般进行乘法运算大约需要6个时钟周期，除法运算大约是20个时钟周期。一次内存访问就需要200个时钟周期，计算与访存之间的延迟非常大。所以存储系统仍将是影响整个计算系统性能的一个关键瓶颈。

现代处理器采用了多层次的、容量和性能不同的缓存，其中上一级缓存容量比下一级缓存小，但是延迟更小、带宽更大。如图展示了越靠近 CPU 的存储器速度越快，容量越小，每比特价格越高；而越远离CPU的存储器速度越慢，容量越大，每比特价格越低。如何让处理器的访问尽可能地发生在距处理器较近、访问时间较短的存储层次中是减少处理器访问延迟的关键。



### 编译器能力的局限性

编译器作为人机语言交互的桥梁，其功能是将程序员编写的高级语言程序翻译成面向目标机器的可执行程序。一个编译器的好坏取决于他的优化能力，它需要根据指令集的特点将代码尽可能的优化，以得到更快的执行速度

并行化编译系统已成为高性能计算机系统中重要的组成部分，该编译系统通过自动检测程序中潜在并行性，将原始的串行语法成分自动地转变为等价的并行语句，极大地减少了程序员改写并行程序的工作量。 



#### 影响编译器效果的原因

* 编译器采用的程序静态分析技术自身有能力的局限。
* 编译策略的保守性原则制约了编译优化的能力。
* 编译器要在通用性和高效性之间保持微妙的平衡。
* 编译器采用何种优化策略还要考虑用户对编译时间的容忍度。
* 体系结构与计算器件的快速升级与迭代对编译器充满挑战。 



### 编程模型的局限性

并行编程模型通过抽象并行计算机体系结构，提供给程序员一种方便与算法结合的编程逻辑，常见的编程模型如CUDA、OpenACC、OpenCL、OpenMP、MPI等。但是当前的并行编程模型也有其局限性，如OpenMP主要针对于共享存储结构，MPI主要针对与分布存储结构。

为了减轻程序员的编码负担，编程模型倾向于隐藏底层设备的细节，但也意味着可能会限制了程序与底层硬件的深度结合，而使程序失去了获得更高性能的机会，表现在以下三个方面：

1. 编程模型无法充分表达程序的理想性能。
2. 编程模型无法充分发挥硬件的计算性能。
3. 编程模型对硬件支持的局限性也会引起程序性能的降低。



## 意义

1. 提高生产力水平
2. 提高资源利用率
3. 降低成本
4. 满足时效性
5. 增强用户体验



## 参考

https://www.bilibili.com/read/cv25998686/?spm_id_from=333.999.0.0

https://www.bilibili.com/read/cv25996593/?spm_id_from=333.999.0.0

https://www.bilibili.com/read/cv26026315/?spm_id_from=333.999.0.0

https://www.bilibili.com/read/cv26044608/?spm_id_from=333.999.0.0