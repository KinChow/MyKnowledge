# 进程和线程

## 进程内存布局

进程是执行用户程序的环境，包括进程空间内的数据和内核里的元数据（上下文）



栈：存放函数参数、局部变量等，使用一级缓存

堆：动态内存，程序中分配释放，使用二级缓存

使用栈的效率比堆要高



## 动态库机制

linux下动态链接是通过PLT&GOT实现，并通过PLT&GOT实现延迟绑定。

全局偏移表（GOT，Global Offset Table）存放外部的函数地址的数据表

程序链接表（PLT，Procduce Link Table）存放额外代码的表



使用-fPIC，模块内部的函数和变量均放到PLT或GOT表中





## 多线调度机制

CFS调度策略

* SCHED_NORMAL
  * 分时调度，用户进程默认策略
* SCHED_BATCH
  * 假定任务是cpu密集的，有较小的调度开销和较大的交互时延



RT类调度器策略

* SCHED_FIFO
  * 有优先级的先进先出
* SCHED_RR
  * FIFO的简单增强，相同的优先级有时间分片机制





## 并发和并行

并发：一个处理器同时处理多个任务

并行：多个处理器或者多核的处理器同时处理多个不同的任务



常用同步原语

* 自旋锁
* 互斥锁
* 读写锁



优化方式：

* 正确选择锁
* 减少临界区范围
* 减少竞争
* 无锁机制
* 免锁机制



伪共享：多线程修改互相独立的变量时，如果变量同一个缓存行（cache line），就会影响彼此的性能，这就是伪共享



优化方式：热点数据进行cache line对齐