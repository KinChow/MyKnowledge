# 自动对焦

## 简介

摄影的过程中，经常会遇到图像模糊的情况，一般是对焦异常导致，也就是我们常说的“失焦”，而自动对焦便是为了使拍出的样张变得更清晰。



自动对焦（Auto Focus，简称AF）是一个复杂的光电一体化过程
*  自动判断所拍摄的主体，
*  测量被摄主体与相机感光元器件之间的距离；
*  驱动马达将镜头的对焦装置推到与之相应的距离刻度



合焦是什么意思呢？
拍摄照片时，被拍摄物体清晰成像，叫做合焦



## 分类

* 主动式：激光对焦、TOF对焦等
  * 优势：低反差、弱光线、细线条、运动物体。
  * 劣势：当被摄体能吸收光波时、光波被玻璃反射等场景。
* 被动式：相位对焦、反差对焦等
  * 优势：自身无发射系统，耗能少，小型化、逆光场景。
  * 劣势：细线条、弱光下、偏光物体、运动物体。



### 反差对焦 （CDAF）

#### 原理和过程

反差对焦（Contrast Detection Auto Focus，简称CDAF），又称对比度对焦，是目前普及率最高、使用最广泛、成本相对较低的自动对焦技术。



反差对焦可以理解为一个反复迭代逐渐收敛的过程

* 计算反差度
* 移动镜头，比较反差度
* 直到反差度最大



反差对焦的过程实质上是求最大值的过程，反差对焦类似手动对焦的过程：模糊-清晰-模糊，然后回到清晰的焦距

1. 未合焦状态图像处于虚焦状态
2. 对焦开始状态镜头开始移动，画面逐渐清晰，对比度开始上升
3. 合焦状态对比度最高画面最清晰，继续移动镜头
4. 继续移动镜头发现对比度开始下降，错过焦点
5. 镜头回退至对比度最高的位置，完成对焦



#### 优缺点

优点

* 物理成本低
* 无单独的子系统，不占用独立的空间
* 对焦精度高

缺点

* 对焦耗时会比较长，在纯色或者反差不明显的场景，对焦时间过长或精度低



#### 难点

一个是降低序列图像的规模，减少对比次数；另一个是更加快速密集的数据源，让数据提供变得更快。



感光器的采样帧率

采样帧率，也称为实时刷新率，反差对焦性能不佳的关键原因。



镜头的采样帧率

镜头同样也有采样帧率的概念，一般也用FPS表示。步进马达和镜头的协调工作更好地提高反差对焦的性能



### 相位对焦（PDAF）

#### 原理和过程

相位对焦（Phase Detection Auto Focus，简称PDAF），全称是“相位检测自动对焦”

* 计算相位差
* 查表，计算马达的理想位置
* 驱动马达，实现快速对焦



在整体相位检测焦点位置之后，镜头驱动模块会将镜片组进行移动合焦，因此耗时更少

PDAF sensor在CMOS上面一半的位置加了金属遮盖，从像素传感器上找出成对像素点，通过相位差检测，找出准确的对焦点，马达一次将镜片推动到相应位置完成对焦。



#### 优缺点

优点：一般计算一次即可完成对焦，马达移动距离更短。
缺点：专用PDAF sensor，暗环境效果差。



#### 比较

相位式：只需要计算一次即可完成对焦
反差式：需要计算多次才能完成对焦



### 激光对焦（LDAF）

#### 原理和过程

激光对焦（Laser Detection Auto Focus 简称LDAF），也称为测距式对焦

激光对焦的原理是通过单独的红外激光传感器向被摄物体发射低功率红外激光，经过反射后被传感器接收，在计算出被摄物体之间的距离之后，对焦马达便会将镜片组驱动到相应位置完成对焦。



#### 优缺点

优点：暗环境、纹理不明显的纯色区域
缺点：对焦距离有限制，距离远的主体对焦效果差



### TOF对焦

#### 原理和过程

TOF是飞行时间（Time of Flight）技术的缩写，即传感器发射红外光，经被摄物体后反射，传感器通过计算光线发射和反射时间差或相位差，计算被拍摄景物的距离。

TOF对焦的原理是通过ToF传感器的自动对焦系统，检测物体与相机之间的距离来进行对焦



#### 优缺点

优点：计算一次即可完成对焦，降低处理器计算负担，降低了背景光的干扰
缺点：物理器件性能要求很高，时间测量精度要求高