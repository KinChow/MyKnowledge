# 3A统计概述

## 3A基本概念

### 3A的定义

* 自动曝光（Auto Exposure，AE）
  * 输出亮度、运动信息
* 自动对焦（Auto Focus，AF）
  * 输出距离、位置、深度、运动、方向信息
* 自动白平衡（Auto White Balance，AWB）
  * 输出光源、人脸信息



### 3A的作用

感知现实环境，正确地配置相机，为其他处理提供参考信息

* 对sensor进行调节

* 为后处理提供信息



### 什么时候进行3A

一般在黑电平矫正和坏点矫正完成后，获取3A统计信息。



### 相关概念

#### 曝光（Exposure）——亮度

光圈：控制进光量

* 光圈开大：进光孔径增大，进入相机的光线越多，曝光量越多，画面越亮
* 光圈缩小：进光孔径缩小，进入相机的光线越少，曝光量越少，画面越暗



快门速度：控制曝光时间

* 快门速度越快，曝光时间越短，适合抓拍或拍摄运动物体
* 快门速度越慢，曝光时间越长，适合记录光点运动轨迹



感光度：感光元件对光线敏感程度

* ISO越小，对光线的感应能力越弱，但是画质表现较好
* ISO越大，对光线的感应能力越强，但是会形成早点影响画质



#### 对焦（Focus）——清晰度

一张好的照片，清晰是基础。对焦成功与否决定照片的清晰度。



#### 白平衡（White Balance）

* 还原环境的真实色彩
  * 画面偏黄就降低色温K值
  * 画面偏蓝就提高色温K值
* 调整画面冷暖
  * 需要偏黄的暖色调效果时，调高色温K值
  * 需要偏蓝的冷色调效果时，降低色温K值



## 3A统计信息

### AE统计信息

* 统计区域和ROI中R/G/B的256-bin直方图
* 统计区域和ROI中Y的256-bin直方图
* 统计区域和ROI中RGB combine直方图
* 对于不同测光（点测光、中心测光、矩阵测光），可以把全图分为M*N块，按照不同测光，每块权重不一样



### AF统计信息

* 选取统计区域并分为M*N块，统计每块的Focus value



Focus value计算方法

* 早期ISP会使用固定的filter来提取图像的细节
  * 比如使用拉普拉斯滤波器，提取图像的高频信号。图像使用高频滤波器，图像的细节被提取出来。细节越清晰，focus value越大
  * 问题：当图像没有那么多边缘，或者图像边缘不锐利时，比如云彩，使用高频滤波器无法提取边缘，导致无法根据该滤波器提取其边缘是否为最锐利
* 现在常用FIR filter和IIR filter
  * FIR滤波器：根据系统的特点去添加不同的系统bi，得到想要的频率响应特点（高通、低通、带通）
  * IIR滤波器：更加灵活配置参数，设置想要的频率响应



### AWB统计信息

* 选取统计区域并分为M*N块，统计每块的R/G/B均值与白点个数
* 选取统计区域并分为M*N块，统计每块的R/G和B/G均值