# 镜头暗角校正

## 镜头暗角概念

由于镜头光学系统原因，使得获得的图像中间比较亮，边缘比较暗，这个现象就是光学系统中的渐晕。由于渐晕现象带来的图像亮度不均会影响后续算法处理的准确性，需要先经过镜头暗角校正功能来消除渐晕给图像带来的影响。



Lens shading一般被称之为暗角或镜头阴影或者镜头暗影，是指图像中心区域和图像四角区域的亮度或者色彩不一致的现象。

* Luma shading（亮度均匀性）就是所谓的vignetting，镜头的通光量从中心到边角减小，造成sensor的亮度响应从中心到边角的变小。图像看起来是，中心亮，四周逐渐变暗。
* Color shading（色彩均匀性）就是RGB plane没有重合，图像看起来就是中间颜色和四周颜色不一致。



## 产生原因

### Luma shading

* lens机械结构：lens的工艺误差、导致光线在lens内的传播受到影响
* lens光学特性：lens中间区域的穿透能力大于边缘区域



### color shading

* Lens折射率：Lens对不同光线的折射程度不一样
* CRA不匹配：SENSOR感光区域上面微透镜的CRA和Lens的CRA不匹配导致




## 镜头暗角校正原理

基本思想
$$
PCOR(x,y)= P_{IN}(x,y)*F(x,y)
$$

* PIN(x,y)：每一个输入的像素值

* F(x,y)：矫正函数，矫正的因素依赖于框架中每帧像素的坐标值



## 方法

### 双线性插值

* 拆分block
    * 将输入图像分为NxM个block
    * 每个block大小可以不一样，但是要满足中心对称的
* 双线性插值
    * 每个block的矫正函数都是由block，四个顶点坐标双线性差值得来




## 镜头暗角的评测方法

* 客观评测
  * 主要是对一些均匀光源，如A光、C光、D65等
* 主观评测
  * 主要是对一些色彩单一的物体拍摄，如天空、地板、墙面、白纸、天花板等