# 色差校正

## 色差背景和产生原因

因为透镜对不同波长的色光有不同的折射率，所以光学上透镜无法将各种波长的色光都聚焦在同一点上。一般在高亮度或高对比度区域的边缘上明显的杂色，我们把它叫做色差 （chromatic aberration）。



### 分类

#### 纵向色差（轴向色差）

当颜色随着焦点的移动而变化的时候，我们认为出现了纵向色差；

同时选择小光圈也会抑制纵向色差；因小光圈的镜片直径越小，景深更大，这使得红色和蓝色相对于绿色的弥散程度更轻，表现在图片上就是纵向色差被抑制了；



#### 横向色差（侧向色差）---最主要的色差问题



### 纵向色差与横向色差的异同

*  相同点：
    *  两者都是因为不同波长的可见光在通过透镜时的折射率不同所导致的；
    *  两者在图像上都表现为突兀的颜色边缘，一般以紫边为主，蓝边、绿边、青边、红边、黄边也很常见；
    *  两者常见于图像中的高对比度区域；
*   不同点：
    *   纵向色差
        * 纵向色差均匀分布于整张图像之内；
        *  通过调节镜头光圈大小等参数，我们可以削弱纵向色差；
    *   横向色差
        *  从图像中心到图像边缘，横向色差会变得越来越严重
        * 无法通过调节镜头参数米削弱横向色差

对于消色镜头，红色分量和蓝色分量会呈现一致的变化规律；

而对于正常的镜头，红色分量和蓝色分量的变化规律并不一致，而是与他们的波长正相关；



## 色差校正的方法

### 全局校正

横向色差实际上是一种径向上的变形，距离图像中心越远，变形程度越大，通常我们需要将蓝色通道向外扩展，将红色通道向内收缩。



### 局部校正

* 色差在图像上最直观的表现就是高亮度高对比度区域的彩色边缘；
*  我们可以通过像素点的梯度信息和色差（color difference）信息，来判断其是否属于边缘区域，然后根据其是否是“不正常”的颜色（以紫色为主），来判断是否要对他进行颜色上的修正；



## 色差校正的难点

* 普适性与局部性
*  场景难以检测，校正尺度难以把握