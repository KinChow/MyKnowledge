# 图像传感器

* 将镜头的光信号转化为电信号，再经过内部AD将模拟电信号转化为数字信号。
* sensor中每个像素点只能感光R、G、B中的一种，这些最原始的感光数据称为RAW数据。
* 类型
  * CCD
  * CMOS
  * CMOS和CCD光电转换原理相同，电荷和读取方式不同。



## sensor栈结构

### 类型

#### BSI（后照式）

* 物镜
* IR滤光片（IR cutter）
* 微透镜（micro lens）
* 滤光镜（color filter array）
* 像素阵列（sensor array）
* 电路层（wiring layer）



#### FSI（前照式）

* 物镜
* IR滤光片（IR cutter）
* 微透镜（micro lens）
* 滤光镜（color filter array）
* 电路层（wiring layer）
* 像素阵列（sensor array）



#### BSI（后照式）和FSI（前照式）差异

FSI（前照式）电路层在前，像素阵列在后，优点工艺简单。

BSI（后照式）像素阵列在前，电路层在后，优点像素阵列可以接收更多的光，模组的光电转换强。



### 滤光片（IR cutter）

滤光片过滤红外光，消除偏色。



### 滤光镜（Color Filter Array）

滤光镜只允许特定的光通过，但是实际无法将所有的光分开。



#### 滤光镜分类

* RGGB
  * 主流sensor，可以采集R、G、B信息。
* MONO
  * 收集亮度信息。
* RYYB
  * 将绿色分量替换为黄色分量。
* RGB-IR
  * 将RGGB中的一个绿色分量替换为IR信息。
* RCCB
  * 恢复亮度信息和R通道、B通道信息。
* RCCC
  * 恢复亮度信息和R通道信息。



### 像素阵列

单像素电路模型：

光电二极管 + 电容



转换过程：

* e（光信号）->a（电流信号）
* a（电流信号）->v（电压信号）



光电二极管的工作原理

* 二极管的反向截止特性
* 光电效应
  * 光的强度越大，反向电流越大
* 电容
  * 电流转电信号



### 电路层

单个像素的读取过程

1. 光信号转换为电压信号
2. 模拟放大
3. AD转换



整图读取过程

1. 行选择：一帧图像的输出是以行为单位的
2. 模拟放大
3. AD转换
4. 列选择：多路选择器，并转串
5. 输出



### 工作时序

$$
帧时间 = 曝光时间 + 读取时间 + 帧间空白
$$

读取时间：最后一行曝光结束到读取结束工作时间

sof：帧开始时刻，第一行读取开始的时刻

eof：帧结束时刻，最后一行读取结束的时刻



## sensor缺陷

### 黑电平（black level）

#### 现象

用完全不透光的材料遮挡住sensor采集的光线，此时sensor的输出不为0。



#### 产生原因

* 暗电流
* 模拟放大
* AD转换



#### 如何改善

* 黑电平矫正：参考标定数据和Optical black



### 串扰（crosstalk）

#### 类型

* 频谱串扰
  * 产生原因：滤光镜无法完全滤除其他颜色的光
* 折射串扰
  * 产生原因：由于光的入射角度，本应入射到该像素点的光线，入射到其他像素点
* 电子转移串扰
  * 产生原因：像素的电子井存储过多电子，而产生溢出



#### 如何改善

* color correction模块
* BSI栈结构
* 增加电子井深度



### 光晕（Lens shading）

#### 类型

* 亮度晕影
  * 产生原因：由于镜头是一个凸透镜，sensor接收的光周边的强度比中间的强度小，中心和周边的亮度不一致
* 色彩晕影
  * 产生原因：类似三棱镜折射，经过透镜折射产生颜色不一致的现象



### 果冻效应（Rolling shutter）

#### 现象

拍摄高速运动物体时，拍摄结果物体扭曲、倾斜、摇摆不定



#### 产生原因

* 高速运动
* 卷帘曝光