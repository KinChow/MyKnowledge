# 图像视频质量评价

## IQA简介

### IQA是什么

定义

*   图像质量评价（Image Quality Assessment, IQA）以及视频质量评价，主要通过对图像进行特性分析研究，然后评估出图像优劣（圆像失真程度）的方法。
    *  按评价主体划分：主观质量评价，即人对于图片的主观感知评价，一般使用MOS或者DMOS指标来定量描述，其获取方式是通过开展主观心理学实验；客观质量评价，其评价主体为机器，通常是设计一个分类器或回归器对图片进行评价。
    * 按是否有参考源来划分：全参考，只能在拥有无失真的原始图像存在的情况下进行，精度相对较高；半参考，只有原始图像的部分信息或从参考图像中提取的部分特征；无参考，仅有失直图像而无任何参考图像，因此难度较高，精度较低 
    评价主体分类
* 主观评价：
    * 准确可靠，但耗时耗力
* 客观评价：
    * 逼近主观评价水平，自动便捷



### IQA能做什么

场景价值（采编传显）

* 成像领域：手机拍照、车载、监控等领域，用于测量Lens->Sensor->ISP->后处理增强等通路会形成各种质量损失（如偏色、对焦模糊、噪声、渐晕等），帮助产品提升产品质量
* 编解码领域：图像/视频编解码、传输领域，用来测量编码器引入的损伤（如块效应、模糊等），进而帮助提升编解质量。




## 成像领域

### DXO Mark总览

* 从清晰度、噪声、曝光、颜色、均匀性、以及时域稳定性等指标进行评测
* 综合照片、变焦、视频场景等主客观评分，融合权重，计算总体得分，进行排名



### 成像评测维度

* 清晰度
  * 解析力
    * 客观
      * MTF50
      * Acutance
      * ringing
    * 主观
      * 模糊
      * 过锐
  * AF
    * 客观
      * 准确性
      * 速度
    * 主观
      * 清晰度
      * 速度
* 噪声
  * 噪声
    * 客观
      * SNR
      * grain size
    * 主观
      * 大小
      * 密集度
      * 对比度
  * 彩照
    * 客观
      * coloration index
    * 主观
      * 彩躁数量
      * 彩躁颜色
  * 暗信号、像素缺陷
    * 客观
      * Dark Signal
      * Bright pixels
      * Dark pixels
* 曝光
  * ISO
    * 客观
      * ISO sensitivity
  * 色调曲线
    * 客观
      * gamma2.2
  * 灰阶/高动态/对比度
    * 客观
      * contrast range
      * tonal range
    * 主观
      * 死黑
      * 过曝
      * 朦胧
* 颜色
  * 白平衡、色偏
    * 客观
      * Δab
    * 主观
      * 偏色
      * 不白
  * 饱和度
    * 客观
      * ΔH
    * 主观
      * 不艳丽
* 均匀性
  * 横向色差
    * 客观
      * distance of color center
    * 主观
      * 边缘带颜色
  * 纵向色差
    * 客观
      * difference of MTF between color channels
    * 主观
      * 紫边
  * shading
    * 客观
      * luminance vignetting
      * color vignetting
    * 主观
      * 暗角
  * 畸变
    * 客观
      * TV系数
    * 主观
      * 周边压扁
      * 周边拉长
* 稳定性
  * 清晰度
    * 客观
      * zoom解析力
      * zoom AF code
      * 运动 AF code
    * 主观
      * 运动主体清晰
      * zoom主体清晰
  * 曝光
    * 客观
      * 曝光 ΔY
    * 主观
      * 亮度闪烁
  * 噪声
    * 客观
      * 噪声 Y 均方差
    * 主观
      * 噪声跳动
  * 颜色
    * 客观
      * 色温 Δab
      * zoom Δab
    * 主观
      * 颜色跳变
  * FOV
    * 客观
      * 缩放平滑
    * 主观
      * 缩放卡
      * 位置跳跃
  * 防抖
    * 客观
      * ΔX
      * ΔY
      * ΔRoll
      * ΔYaw
      * Δpitch
    * 主观
      * 画面抖动



### DXO客观评测方法

*   整套环境
    * 光源：控制亮度、色温等
        * 灯源：带照度反馈回路的自动照明控制系统
    * 图卡：点图、枯叶图、色卡、MTF图卡等
        * 点图：测量shading、锐度、畸变、焦距
        * 径向MTF图：不同位置提供径向（矢向和切向）MTF
        * HDR图：测量HDR、动态和色调范围、色调曲线、噪声分析
        * 色卡：测量白平衡、色彩还原度和色彩敏感度
    * 分析软件：DXOMARK Analyzer
        * Analyzer：进行分析图像，计算结果
    *  其他：架子、滑轨等



### 行业标准

* ISO TC4
    *   ISO 12233：分辦率和空间频率
    * ISO 12232：ISO，标准输出感光度
    * ISO 15739：噪声和动态范围
    * ISO 14524：色调曲线OECF标准
    * ISO 17850：几何畸变
    *  ISO 17957：均匀度/阴影测量
    *   ISO 18844：耀斑 Flare
    * ISO 19084：色移、紫色
    * ISO 19567：纹理
* CPIQ (IEEE P1858)
    *   空间频率响应
    * 横向色位移口
    * 颜色均匀度
    * 几何畸变
    * 纹理模糊
    * 噪声
    * 色度



### 色彩

* CIELAB：一种色彩空间，为了涵盖正常人可见范围所有色彩所设计，其欧式距离与人眼所能识别的偏差相对应
* `ΔE*`/`ΔC*`/`ΔH*`/`Δab*`：分辨表示欧式距离、色度误差、色调误差、色彩误差
* White balance：白平衡，校正白点的色彩误差



### 清晰度

* Modulation transfer Function：调制传递函数
* Spatial Frequency Response：空间频率响应
* MTF 50：是指对比度剩余50%时候的对应频率，常说的MTF多少线对就是这个，单位是cycle/pixel或者cycle/height
* Ringing：振铃效应，一黑亮边缘通过图像处理增强出更加黑亮过渡带的现
* Nyquist：奈特斯特频率，是指数字图像中能给出的最大频率，这里可以理解成分辦率的高的一半，因为超出这个数字，黑白线对将无法呈现



## 编解码领域

### 视频编解码质量评价算法-有参

在视频编码环节，质量评价和测试分为以下几类（有参考）：

* 信号域：以PSNR为代表，基于信噪比，仅孤立考虑像素差异素；
* 视觉特征：以SSIM（MSSSIM）为代表，基于空间特征，只考虑空域（亮度相似度，对比度相似度和结构相似度）
* 机器学习：以VMAF（开源）为代表的，基于主观感知，需考虑多种感知因素通过机器学习算法；
* 深度学习：以LPIPS（开源）为代表的，基于CNN卷积网络提取特帧，进行回归；



#### PSNR

* Mean Square Error (MSE) / Peak Signal to Noise Ratio (PSNR)
*   均方误差（MSE）和峰值信噪比（PSNR）是比较常见的两种基于像素统计的有参质量评价方法。它们通过计算待评测图像和参考图像对应像素点灰度值之间的差异，从统计角度来衡量待评图像的质量优劣。
*   均方误差（MSE）和峰值信噪比（PSNR）由于其简单易用速度快的特性，应用十分广泛。在目前应用最广泛的视频编码标准H.264/AVC和最新的H.265/HBVC中，PSNR依然是最主要的客观评价方法。
*  但MSE/PSNR与主观的感受一致性低，并不能完全反应人眼视觉系统的感受。相同MSE/PSNR可对应感官差异非常大的各种失真。



#### SSIM

* Structural SIMilarity（SSIM）结构相似性
* 结构一致性（SSIM）是一种基于结构信息的有参质量评价方法。基于人类视觉感知能高度自适应提取场景中的结构信息，该方法认为图像的结构失真的度量应是图像感知质量的最好近似，因此从亮度、对比度、结构三方面描述像素间的一致性。
* 结构一致性（SSIN）实现简单，融入了人眼视觉感受信息，质量评估结果可靠。相同MSE/PSNR的失真图像，SSIM能够准确分辨出主观质量好坏。



#### VMAF

*   视频多评估方法融合（Video Multi-method Assessment Fusion简称VMAF）指标是一种将人类视觉模型与机器学习相结合的视频质量评价指标
* VMAF在支持向量机（SVM）回归因子中使用下列基本指标进行融合：
    * 空域指标：
        * 视觉信息保真度 （Visual Information Fidelity, VIF）
            * 用信息论的知识把人眼从失真图像中提取到的信息与从原始图像中提取的信息作比较，得出质量评价指标
        * 细节丢失指标 （Detail Loss Metric,DLM）
            * DLM是一种图像质量指标，其基本原理在于：分别衡量可能影响到内容可见性的细节丢失情况（DLM），以及可能分散观众注意力的不必要损失Additive Impairment Measure（AIM），原论文将DLM和AIM结合在一起算出最终分数。在VMAF中只使用DLM作为基本指标
    * 时域指标：
        * 运动量
            * 衡量相邻帧之间时域差异，计算像素亮度分量差值的均值



## 媒体质量评价探索

### 成像领域：图像视频的美学评价

通过搭建了一个美学评价模型，初步建立的美学评价各子维度（光照、色彩、构图）的评价标准和总体评价能力。



美学评价模型

* 输入：图像或视频
* 输出：光照、构图、色彩
* 评价指标：MSE、SROCC



### 视频无参质量评价算法

视频无参质量评价算法包1.0：包含抖动、清晰度、亮度彩、噪声等一致性评价算法



### 有参算子：光影秩序错误检测算法

应用场景：亮度秩序错误（LOE-Lightness Order Error）作为一个客观衡量图像后处理对光影亮度改变程度的有参图像评价指标，用于HDR风格生成、CG渲染等各类图像后处理方法的光影整体评价及问题定位